При возникновении проблем с сетью SRE-инженер должен уметь быстро понять, что не работает: **интернет, DNS, маршрутизация, firewall или что-то ещё**. Разберём ключевые команды и приёмы.
# Проверка доступности узла (`ping`)
`ping` отправляет ICMP-запросы на удалённый узел и проверяет, отвечает ли он.

 **Пример:**
```bash
ping 8.8.8.8
```

**Что показывает:**
- Если **ответы есть** – соединение установлено.
- Если **нет ответов**, но DNS работает – возможно, блокирует firewall или сеть недоступна.
- Если **потеря пакетов** → проблемы с сетью.

**Полезные опции:**
```bash
ping -c 5 google.com  # Отправить 5 пакетов 
ping -i 0.2 google.com  # Изменить интервал (0.2 сек) 
ping -s 1000 google.com  # Указать размер пакета (1000 байт)
```
# Трассировка маршрута (`traceroute`, `tracepath`)
Определяет маршрут до узла и выявляет, где могут быть задержки.

 **Пример:**
```bash
 traceroute 8.8.8.8
```
или, если `traceroute` не установлен:
```bash
tracepath 8.8.8.8
```

**Что показывает:**
- Какие маршрутизаторы проходят пакеты.
- Где возможны задержки (время ответа).
- Где пакеты теряются (если `* * *` вместо ответа – возможно, фильтрация ICMP).

**Пример выхода:**
```bash
1  192.168.1.1  1.123 ms 
2  10.0.0.1  5.456 ms 
3  203.0.113.1  30.789 ms 
4  8.8.8.8  40.123 ms
```
Если задержка резко возрастает или маршрут обрывается – там и проблема.
# Проверка DNS (`nslookup`, `dig`, `host`)
Если `ping google.com` не работает, но `ping 8.8.8.8` работает → **проблема с DNS**.
## Проверка DNS-запросов:
```bash
nslookup google.com
```
или:
```bash
dig google.com
```
или:
```bash
host google.com
```

**Что показывает:**
- IP-адрес домена (если нет ответа – DNS не работает).
- Какие DNS-серверы отвечают.
## Проверка, какой DNS-сервер используется:
```bash
cat /etc/resolv.conf
```
Если там указаны неподходящие серверы → проблема может быть в конфигурации.
# Проверка портов и соединений (`netstat`, `ss`, `telnet`, `nc`)
Если сервис не работает, стоит проверить открытые порты.
## Проверка всех открытых портов:
```bash
netstat -tulnp
```

или (более современный аналог `netstat`):
```bash
ss -tulnp
```

**Что показывает:**
- Какие порты прослушиваются (`LISTEN`).
- Какой процесс их использует.
## Проверка доступности порта на удалённом сервере (`telnet`, `nc`)
```bash
telnet google.com 443
```

или, если `telnet` не установлен:
```bash
nc -vz google.com 443
```

**Что показывает:**
- Если подключение успешно → порт открыт.
- Если ошибка подключения → порт закрыт или фильтруется.

# Проверка маршрутизации (`ip route`, `ip addr`)
Если соединение не устанавливается, можно проверить маршруты.
## Посмотреть таблицу маршрутов:
```bash
ip route show
```
или:
```bash
route -n
```

**Что показывает:**
- Основной шлюз (`default via` – если его нет, интернет не работает).
- Какие сети куда направляются.

## Проверить IP-адреса интерфейсов:
```bash
ip addr show
```
или:
```bash
ifconfig
```
Если у интерфейса **нет IP-адреса** – возможно, проблема с DHCP или ручной настройкой.

# Проверка сетевых интерфейсов и доступных Wi-Fi (`nmcli`, `iwconfig`)
Если проблема в Wi-Fi, можно проверить:
## Проверка доступных сетей:
```bash
nmcli dev wifi list
```
или:
```bash
iwconfig
```
Если сети нет в списке → возможно, проблема с драйверами.
# Логирование и поиск ошибок (`dmesg`, `journalctl`)
Если сеть не работает после изменений, полезно заглянуть в логи.
## **Проверка системных логов по сети:**
```bash
dmesg | grep -i eth
```
или:
```bash
journalctl -xe | grep -i network
```
Можно найти ошибки при загрузке сетевых интерфейсов или конфликты адресов.
# Дополнительные полезные команды
## Обновление IP и маршрутов (DHCP-клиент)
Если сеть не работает из-за IP-адреса, можно запросить новый:
```bash
dhclient -r && dhclient eth0
```
или:
```bash
systemctl restart NetworkManager
```
## Сброс DNS-кэша
Если DNS работает странно:
```bash
systemctl restart systemd-resolved
```
или (для `NetworkManager`):
```bash
nmcli networking off && nmcli networking on
```
## Сканирование открытых портов (если есть `nmap`)
```bash
nmap -p 1-65535 192.168.1.1
```
Покажет, какие порты открыты на узле.
# Как действовать при сетевой проблеме?

1. **Проверить связь (`ping`):**    
    - Если **нет связи по IP** → проблема с сетью.
    - Если **есть связь по IP, но нет по домену** → проблема с DNS.
2. **Проверить маршрут (`traceroute`)**    
    - Где теряются пакеты?
3. **Проверить порты (`netstat`, `ss`, `telnet`, `nc`)**    
    - Открыт ли нужный порт?
4. **Проверить конфигурацию сети (`ip route`, `ip addr`)**    
    - Есть ли IP? Есть ли `default gateway`?
5. **Посмотреть логи (`dmesg`, `journalctl`)**    
    - Есть ли ошибки при старте сети?