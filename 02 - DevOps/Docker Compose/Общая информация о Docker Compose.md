**Docker Compose** — это инструмент для упрощенного управления многоконтейнерными приложениями Docker. С его помощью можно определить все контейнеры, их настройки, сети, тома и зависимости в одном YAML-файле. Ниже — ключевые концепции и основные моменты о Docker Compose:
### **1. Основы Docker Compose**
- **Файл `docker-compose.yml`**: центральный файл, где описываются все сервисы (контейнеры), их зависимости, сети, тома и переменные окружения.
- **Команда `docker-compose`**: используется для управления описанными контейнерами (запуск, остановка, пересборка и др.).
### **2. Структура файла `docker-compose.yml`**
Файл состоит из нескольких разделов:
#### **Пример минимального файла:**
```yaml
version: "3.8"  # Указывает версию Compose (лучше использовать последние версии)
services:       # Определяет сервисы (контейнеры)
  web:          # Название сервиса
    image: nginx:latest  # Используемый образ
    ports:
      - "8080:80"  # Пробрасываем порт 8080 на порт 80 контейнера
    volumes:
      - ./html:/usr/share/nginx/html  # Монтируем локальную папку в контейнер
```
### **3. Основные компоненты Docker Compose**
1. **`version`**:    
    - Указывает версию формата файла Compose (например, `3.8` — актуальная версия для современных приложений).
    - Версия определяет доступные функции и возможности.
2. **`services`**:    
    - Содержит список сервисов (контейнеров), которые Compose будет управлять.
3. **`networks`**:    
    - Определяет пользовательские сети для связи контейнеров.
```yaml
networks:
  my_network:
    driver: bridge
```
4. **`volumes`**:
	- Описывает тома для хранения данных контейнеров.
```yaml
volumes:
  my_data:
```
5. **`environment`**:
	- Устанавливает переменные окружения для контейнера.
```yaml
environment:
  - ENV_VAR=value
```
### **4. Команды Docker Compose**
- **`docker-compose up`**: запускает все сервисы (контейнеры) из `docker-compose.yml`.
    - Флаг `-d`: запускает контейнеры в фоновом режиме.
- **`docker-compose down`**: останавливает все запущенные сервисы и удаляет их контейнеры, сети и тома (если они не именованы).
- **`docker-compose ps`**: показывает состояние запущенных сервисов.
- **`docker-compose logs`**: выводит логи контейнеров.
- **`docker-compose build`**: пересобирает образы для сервисов.
- **`docker-compose exec <service> <command>`**: выполняет команду внутри контейнера.
### **5. Преимущества Docker Compose**
- **Удобство управления многоконтейнерными приложениями**: все зависимости и параметры задаются в одном файле.
- **Локальная разработка**: легко поднимаются сложные окружения.
- **Кроссплатформенность**: один и тот же файл может быть использован на разных системах.
- **Легкость масштабирования**: командой `docker-compose up --scale` можно увеличить количество реплик.
### **6. Примеры расширенных функций**
#### **Настройка сети и фиксированных IP:**
```yaml
networks:
  my_network:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.1.0/24

services:
  app:
    image: my-app
    networks:
      my_network:
        ipv4_address: 192.168.1.100
```

**Переменные окружения из файла `.env`:**
```yaml
services:
  db:
    image: postgres
    environment:
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASS}

# Файл .env
DB_USER=admin
DB_PASS=secret
```

**Монтирование томов:**
```yaml
volumes:
  data_volume:
services:
  app:
    image: my-app
    volumes:
      - data_volume:/data
```
### **7. Полезные советы**
- Используйте `.env` для хранения конфиденциальных данных (паролей, ключей).
- Старайтесь явно задавать версии используемых образов, чтобы избежать неожиданных изменений.
- Используйте `docker-compose.override.yml` для переопределения настроек в среде разработки.
- Всегда тестируйте изменения файла `docker-compose.yml` перед запуском в продакшене.