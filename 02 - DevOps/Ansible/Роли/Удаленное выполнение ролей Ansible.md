Роли в ansible выполняются на удаленных узлах через управление задачами с управляющего узла (controle node). Управляющий узел соединяется с управляемыми узлами (managed nodes) по SSH и последовательно выполняет задачи из ролей
# Процесс выполнения роли
1. Определение цели:
	1. В плейбуке будет указываться, какие узлы (или группы узлов) из инвентаря должны выполнить роль
	2. Пример в `playbook.yml`:
```yaml
- hosts: web_servers
  roles:
	- nginx_setup
```
2. Подключение к узлам:
	1. Ansible подключается к каждому узлу из группы `web_servers` через SSH
	2. Это происходит от имени пользователя, указанного в инвентаре, либо текущего пользователя на управляющем узле
3. Передача данных:
	1. Управляющий узел временно передает файлы роли (задачи, шаблоны, переменные и т.д.) на управляемый узел
	2. Эти данные сохраняются в каталоге `/tmp` (или другом временном каталоге), чтобы избежать долгого ожидания при каждом выполнении задач
4. Выполнение задач:
	1. Ansible обрабатывает файл `tasks/main.yml` роли. Все задачи выполняются на управляемом узле в том порядке, в котором они определены.
	2. Если роль содержит зависимости, сначала выполняются они, затем основная роль
5. Обработка хэндлеров:
	1. Если задача вызывает изменения (например, шаблонный файл обновлен), запускаются связанные хэндлеры из `handlers/main.yml`. Например, перезапуск сервиса
6. Очистка:
	1. После выполнения задач временные файлы удаляются с управляемого узла, но результаты остаются (например, установленные пакеты или измененные кофигурации)
# Пример
**Инвентарь** (`inventory.ini`)
```ini
[web_servers]
192.168.1.100 ansible_user=admin
192.168.1.101 ansible_usser=admin
```

**Плейбук** (`playbook.yml`)
```yaml
- hosts: web_servers
  become: yes
  roles:
    - nginx_setup
```

**Роль** `nginx_setup`
1. **task.main.yml**
```yaml
---
- name: Установить Nginx
  apt:
    name: nginx
    state: present

- name: Создать конфигурацию
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
  notify:
    - Перезапустить Nginx
```

2. **handlers/main.yml**
```yaml
---
- name: Перезапустить Nginx
  service:
	name: nginx
	state: restarted
```
# Выполнение
1. Команда запуска:
```bash
ansible-playbook -i inventory.ini playbook.yml
```
2. Шаги, выполняемые Ansible
	1. Подключение к `192.168.1.100` и `192.168.1.101` через SSH
	2. Выполнение задачи установки Nginx на обоих узлах
	3. Копирование шаблона `nginx.conf.j2` на оба узла
	4. Если файл изменился, запускает хэндлер, чтобы перезапустить Nginx
3. Результат
	1. На всех серверах из группы `web_servers` установлен и настроен Nginx
# Важные аспекты удалённого выполнения
1. Пользователи и права доступа
	1. Если для задач требуются привилегии суперпользователя, необходимо добавить `become:yes` в плейбук
	2. Убедиться, что у пользователя, от имени которого выполняется роль, есть доступ по SSH
2. Интерпретатор Python:
	1. На управляемом узле должен быть установлен Python
3. Пусть к временным файлам:
	1. Временные файлы, переданные на управляемый узел, удаляются после выполнения задачи
4. Контроль над узлами:
	1. Можно ограничить выполнение роли только на определенных узлах, используя параметр `--limit`
```bash
ansible-playbook -i inventory.ini playbook.yml --limit 192.168.1.100
```
5. Результаты выполнения
	1. Ansyble выводи в консоль информацию о выполнении задач: успешные, измененные, пропущенные или завершившиеся с ошибкой