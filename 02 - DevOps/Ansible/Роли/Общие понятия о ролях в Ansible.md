Роли в Ansible - это механизм организации и структурирования плейбуков и задач. Они позволяют разбивать сложные конфигурации на небольшие, переиспользуемые и легко управляемые компоненты. Роли упрощают управление инфраструктурой, делая код более читаемым и поддерживаемым
# Основные особенности ролей
1. Структурированность: роли обеспечивают строгую структуру файлов и каталогов, что помогает организовать код
2. Пересиользуемость: роли можно использовать повторно в разных проектах
3. Модульность: каждая роль отвечает за выполнение конкретной функции (например, установка Nginx, настройка MySSQL)
4. Удобство настройки: переменные внутри ролей позволяют гибко адаптировать их под разные сценарии
# Структура роли
При создании роли Ansible автоматически создает рекомендуемую структуру
```python
roles/
└── имя_роли/
    ├── tasks/          # Основные задачи роли
    │   └── main.yml    # Главный файл задач
    ├── handlers/       # Хэндлеры (например, перезапуск сервисов)
    │   └── main.yml
    ├── templates/      # Шаблоны (например, конфиги с использованием Jinja2)
    ├── files/          # Статические файлы (например, бинарники, конфиги)
    ├── vars/           # Переменные с высоким приоритетом
    │   └── main.yml
    ├── defaults/       # Переменные по умолчанию
    │   └── main.yml
    ├── meta/           # Метаинформация о роли (зависимости)
    │   └── main.yml
    └── tests/          # Тесты для проверки роли
        ├── inventory
        └── test.yml
```
# Создание роли
Создание директории для ролей:
```bash
mkdir -p roles/имя роли
```
Создание структуры роли:
```bash
ansible-galaxy init roles/имя роли
```
# Использование роли
1. Включение роли в плейбук: чтоб использовать роль, ее нужно объявить в плейбуке
```yaml
- hosts: web_servers
  roles:
    - имя_роли
```
2. Использование переменных внутри роли: значения переменных мжно переопределить через инвентарь или в плейбуке
3. Зависимости ролей
   В файле `meta/main.yml` можно указать роли, от которых зависит текущая роль
```yaml
dependecies:
	- role: common
	- role: nginx
	  vars:
	    nginx_port 8000
```
# Пример роли
Шаблон роли для установки Nginx
**task/main.yml**
```yaml
---
- name: Установить nginx
  apt:
    name: nginx
    state: present
  notify:
    - Перезапустить nginx
```

**handlers/main.yml**
```yaml
---
- name: Перезапустить nginx
  service:
    name: nginx
    state: restarted
```

**default/main.yml**
```yaml
---
nginx_port: 80
```

**templates/nginx.conf.j2**
```nginx
server {
	listen {{nginx_port}}
	server_name localhost

	location / {
		root /var/www/html;
		index index.html
	}
}
```
# Хранение ролей
Роли можно хранить:
1. Локально в проекте:
	1. Хранятся в директории `roles/`
2. Внешние источники
	1. Ansible Galaxy (`ansible-galaxy intall <имя_роли>` )
	2. Git-репозитории